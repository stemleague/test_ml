<!DOCTYPE html>
<html>
<head>
  <title>ML Prediction with Vega-Lite</title>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body>

  <h2>Enter Features</h2>
  <input id="f1" placeholder="Feature 1" />
  <input id="f2" placeholder="Feature 2" />
  <input id="f3" placeholder="Feature 3" />
  <input id="f4" placeholder="Feature 4" />

  <button onclick="getPrediction()">Predict</button>

  <div id="vis"></div>

  <script>

    async function getPrediction() {

      // Step 1: Extract all the features inputted by user
      const features = [
        parseFloat(document.getElementById("f1").value),
        parseFloat(document.getElementById("f2").value),
        parseFloat(document.getElementById("f3").value),
        parseFloat(document.getElementById("f4").value),
      ];

      console.log(features);
      
      // Step 2: Running the Model
      const response = await fetch('/predict', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ features })
      });

      const result = await response.json();
      console.log(result);
      

      const prediction = result.prediction[0];
      console.log(prediction);
    
      // Step 3: Create the viz
      const spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "data": {
          "values": [{ "label": "Prediction", "value": prediction }]
        },
        "mark": "bar",
        "encoding": {
          "x": { "field": "label", "type": "nominal" },
          "y": { "field": "value", "type": "quantitative" }
        }
      };

      vegaEmbed('#vis', spec);
    }
  </script>
</body>
</html>
